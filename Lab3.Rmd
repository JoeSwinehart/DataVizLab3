---
title: "Lab 3"
author: 
  - Makayla Whitney
  - Joe Swinehart
  - Janette Avelar
  - David Fainstein
date: "2/8/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r setup}
library(ggplot2)
library(here)
library(tidyverse)
library(lubridate)
library(waffle)
library(dplyr)
library(directlabels)
library(gghighlight)
#library(colorblindr)
imported_honey_production <- read.csv(here("data/honeyproduction.csv"))
census_regions <-  read_csv(here("data/us census bureau regions and divisions.csv"))
census_regions %>% 
  rename(
   state=  `State Code`
  )

```

```{r making data friendly}
purifiedhoney <- imported_honey_production %>% 
  select(state, year, totalprod) %>% 
  mutate(
    prodsimpler = totalprod/1000
  )
census_regions <- census_regions %>% 
  rename(
   state=  `State Code`
  )
```


```{r visualize honey production over time}

ggplot(purifiedhoney, aes(year, prodsimpler)) +
  geom_line(aes(group=state),
            color = "gray80") +
  geom_line(data = filter(purifiedhoney,
                           state == "OR"),
           color = "#60D838") +
    geom_line(data = filter(purifiedhoney,
                           state == "WA"),
           color = "#00A1FE") +
  
    geom_line(data = filter(purifiedhoney,
                           state == "CA"),
           color = "#FF634D") +
  scale_y_log10()+
  labs(title = "US Honey Production",
       subtitle = "1998-2012",
       y = "Thousands of gallons",
       x = "Year",
       caption = "The average honey bee's wings flap over 183 times per second.")+    
  annotate(geom = "point", x = 1998, y = 37350, colour = "#FF634D", size = 3) + 
  annotate(geom = "point", x = 1998, y = 37350) + 
  annotate(geom = "text", x = 1998.3, y = 37350, label = "CALIFORNIA", hjust = "left")+    
  annotate(geom = "point", x = 1998, y = 2955, colour = "#00A1FE", size = 3) + 
  annotate(geom = "point", x = 1998, y = 2955) + 
  annotate(geom = "text", x = 1998.3, y = 3500, label = "WASHINGTON", hjust = "left")+    
  annotate(geom = "point", x = 1998, y = 2250, colour = "#60D838", size = 3) + 
  annotate(geom = "point", x = 1998, y = 2250) + 
  annotate(geom = "text", x = 1998.3, y = 1900, label = "OREGON", hjust = "left")

```

```{r colorblind friendly #1 - Duetanomaly}
ggplot(purifiedhoney, aes(year, prodsimpler)) +
  geom_line(aes(group=state),
            color = "gray80") +
  geom_line(data = filter(purifiedhoney,
                           state == "OR"),
           color = "#E5B33F") +
    geom_line(data = filter(purifiedhoney,
                           state == "WA"),
           color = "#8EA7E7") +
  
    geom_line(data = filter(purifiedhoney,
                           state == "CA"),
           color = "#FFE26A") +
  scale_y_log10()+
  labs(title = "US Honey Production",
       subtitle = "1998-2012",
       y = "Thousands of gallons",
       x = "Year",
       caption = "A queen bee can sting multiple times without dying.")+    
  annotate(geom = "point", x = 1998, y = 37350, colour = "#FFE26A", size = 3) + 
  annotate(geom = "point", x = 1998, y = 37350) + 
  annotate(geom = "text", x = 1998.3, y = 37350, label = "CALIFORNIA", hjust = "left")+    
  annotate(geom = "point", x = 1998, y = 2955, colour = "#8EA7E7", size = 3) + 
  annotate(geom = "point", x = 1998, y = 2955) + 
  annotate(geom = "text", x = 1998.3, y = 3500, label = "WASHINGTON", hjust = "left")+    
  annotate(geom = "point", x = 1998, y = 2250, colour = "#E5B33F", size = 3) + 
  annotate(geom = "point", x = 1998, y = 2250) + 
  annotate(geom = "text", x = 1998.3, y = 1900, label = "OREGON", hjust = "left")
```

```{r colorblind friendly #2 - Protanomaly}
ggplot(purifiedhoney, aes(year, prodsimpler)) +
  geom_line(aes(group=state),
            color = "gray80") +
  geom_line(data = filter(purifiedhoney,
                           state == "OR"),
           color = "#FFD960") +
    geom_line(data = filter(purifiedhoney,
                           state == "WA"),
           color = "#A2B6EB") +
  
    geom_line(data = filter(purifiedhoney,
                           state == "CA"),
           color = "#D5A238") +
  scale_y_log10()+
  labs(title = "US Honey Production",
       subtitle = "1998-2012",
       y = "Thousands of gallons",
       x = "Year",
       caption = "A typical Bee colony consists of 30,000 to 60,000 bees.")+    
  annotate(geom = "point", x = 1998, y = 37350, colour = "#D5A238", size = 3) + 
  annotate(geom = "point", x = 1998, y = 37350) + 
  annotate(geom = "text", x = 1998.3, y = 37350, label = "CALIFORNIA", hjust = "left")+    
  annotate(geom = "point", x = 1998, y = 2955, colour = "#A2B6EB", size = 3) + 
  annotate(geom = "point", x = 1998, y = 2955) + 
  annotate(geom = "text", x = 1998.3, y = 3500, label = "WASHINGTON", hjust = "left")+    
  annotate(geom = "point", x = 1998, y = 2250, colour = "#FFD960", size = 3) + 
  annotate(geom = "point", x = 1998, y = 2250) + 
  annotate(geom = "text", x = 1998.3, y = 1900, label = "OREGON", hjust = "left")
```

```{r colorblind friendly #3 - Tritanomaly}
ggplot(purifiedhoney, aes(year, prodsimpler)) +
  geom_line(aes(group=state),
            color = "gray80") +
  geom_line(data = filter(purifiedhoney,
                           state == "OR"),
           color = "#FF8F82") +
    geom_line(data = filter(purifiedhoney,
                           state == "WA"),
           color = "#00AE9C") +
  
    geom_line(data = filter(purifiedhoney,
                           state == "CA"),
           color = "#FFD0BC") +
  scale_y_log10()+
  labs(title = "US Honey Production",
       subtitle = "1998-2012",
       y = "Thousands of gallons",
       x = "Year",
       caption = "An adult worker bee's lifespan is about 45 days.")+    
  annotate(geom = "point", x = 1998, y = 37350, colour = "#FFD0BC", size = 3) + 
  annotate(geom = "point", x = 1998, y = 37350) + 
  annotate(geom = "text", x = 1998.3, y = 37350, label = "CALIFORNIA", hjust = "left")+    
  annotate(geom = "point", x = 1998, y = 2955, colour = "#00AE9C", size = 3) + 
  annotate(geom = "point", x = 1998, y = 2955) + 
  annotate(geom = "text", x = 1998.3, y = 3500, label = "WASHINGTON", hjust = "left")+    
  annotate(geom = "point", x = 1998, y = 2250, colour = "#FF8F82", size = 3) + 
  annotate(geom = "point", x = 1998, y = 2250) + 
  annotate(geom = "text", x = 1998.3, y = 1900, label = "OREGON", hjust = "left")
```

```{r colorblind friendly - desaturated}
ggplot(purifiedhoney, aes(year, prodsimpler)) +
  geom_line(aes(group=state),
            color = "gray80") +
  geom_line(data = filter(purifiedhoney,
                           state == "OR"),
           color = "gray10") +
    geom_line(data = filter(purifiedhoney,
                           state == "WA"),
           color = "gray50") +
  
    geom_line(data = filter(purifiedhoney,
                           state == "CA"),
           color = "gray30") +
  scale_y_log10()+
  labs(title = "US Honey Production",
       subtitle = "1998-2012",
       y = "Thousands of gallons",
       x = "Year",
       caption = "99% of a bee colony is made up of female bees.")+    
  annotate(geom = "point", x = 1998, y = 37350, colour = "gray30", size = 3) + 
  annotate(geom = "point", x = 1998, y = 37350) + 
  annotate(geom = "text", x = 1998.3, y = 37350, label = "CALIFORNIA", hjust = "left")+    
  annotate(geom = "point", x = 1998, y = 2955, colour = "gray50", size = 3) + 
  annotate(geom = "point", x = 1998, y = 2955) + 
  annotate(geom = "text", x = 1998.3, y = 3500, label = "WASHINGTON", hjust = "left")+    
  annotate(geom = "point", x = 1998, y = 2250, colour = "gray10", size = 3) + 
  annotate(geom = "point", x = 1998, y = 2250) + 
  annotate(geom = "text", x = 1998.3, y = 1900, label = "OREGON", hjust = "left")
```

```{r color blind safe palette}
ggplot(purifiedhoney, aes(year, prodsimpler)) +
  geom_line(aes(group=state),
            color = "gray80") +
  geom_line(data = filter(purifiedhoney,
                           state == "OR"),
           color = "#00A078") +
    geom_line(data = filter(purifiedhoney,
                           state == "WA"),
           color = "#FC6426") +
  
    geom_line(data = filter(purifiedhoney,
                           state == "CA"),
           color = "#FFA12C") +
  scale_y_log10()+
  labs(title = "US Honey Production",
       subtitle = "1998-2012",
       y = "Thousands of gallons",
       x = "Year",
       caption = "Bees have an excellent sense of smell.")+    
  annotate(geom = "point", x = 1998, y = 37350, colour = "#FFA12C", size = 3) + 
  annotate(geom = "point", x = 1998, y = 37350) + 
  annotate(geom = "text", x = 1998.3, y = 37350, label = "CALIFORNIA", hjust = "left")+    
  annotate(geom = "point", x = 1998, y = 2955, colour = "#FC6426", size = 3) + 
  annotate(geom = "point", x = 1998, y = 2955) + 
  annotate(geom = "text", x = 1998.3, y = 3500, label = "WASHINGTON", hjust = "left")+    
  annotate(geom = "point", x = 1998, y = 2250, colour = "#00A078", size = 3) + 
  annotate(geom = "point", x = 1998, y = 2250) + 
  annotate(geom = "text", x = 1998.3, y = 1900, label = "OREGON", hjust = "left")

```

```{r join with census regions}
regional_honey_production <- left_join(purifiedhoney, census_regions) %>% 
  group_by(state, Region) %>% 
  summarise(totalprod = mean(totalprod)) %>% 
  ungroup() %>% 
  mutate(Region = as.factor(Region))

# Leaving this in case we need it
#         fct_reorder(Region,
#                            "Midwest",
#                            "West",
#                            "South",
#                            "Northeast"))
```

```{r bar plot showing average honey production, with color indicating region}
ggplot(regional_honey_production, aes(reorder(state, -totalprod), totalprod, fill = Region)) +
  geom_col(aes(group = Region)) +
  coord_flip() +
  labs(title = "Average Honey Production",
       subtitle = "Per state with color indicating region", 
       y = "Total production per gallon (thousands)",
       x = "")
```

Most honey production for the United States occurs in the Midwest and West. This is not surprising as most of the crop production for the country also occurs in these areas; bees would thrive in areas where there are high levels of crop production. The lowest production rate is in the northeast. 

```{r heatmap of average production by region}


head(regional_honey_production)


premium_honey <- imported_honey_production %>%
  select(state, year)

heat_dat <- full_join(premium_honey, regional_honey_production) %>%
  group_by(year, Region) %>% 
  mutate(totalprod = round(mean(totalprod)))

ggplot(heat_dat, aes(year, Region, fill = totalprod)) +
  geom_raster(hjust = 0, vjust = 0) +
  scale_fill_viridis_c(option = "magma")

```

```{r choice plot}



```